---
title: "Visburgh Analysis"
author: "Yuji Shen"
date: "February 25, 2015"
output:
  html_document:
    css: style.css
---

```{r knitr.setting,echo=FALSE}
knitr::opts_chunk$set(warning = FALSE,
                      message = FALSE,
                      echo = FALSE)
```

******

```{r data}
library(reshape2)
library(ggplot2)
library(GGally)
library(dplyr)

setwd('/Users/Yuji/Workspace/R/Visburgh')
data <- read.csv("data.csv", header=F, na.strings = "N/A")

sub <- data[match(c("North Oakland", "Central Oakland", "South Oakland", "West Oakland", "Shadyside", "Squirrel Hill North", "Squirrel Hill South"), data[[1]]), ]
```

## Population

```{r population}
pop <- data[c(1,3:10)]
colnames(pop) <- c("neibor", seq(1940, 2010, 10))

boxplot(pop[-1],main = "Population in Pittsburgh")
```

First, let's look at the overall trends of population in Pittsburgh. As you can see in the box plot, the median population of neighborhoods incresed a little in 1950 then decresing until 2010. This is true according to history:

> In the latter 20th century, the area shifted its economic base to education, tourism, and services, largely based on healthcare/medicine, finance, and high technology such as robotics. Although Pittsburgh successfully shifted its economy and remained viable, the city's population never rebounded to its industrial-era highs. While 680,000 people lived in the city proper in 1950, a combination of suburbanization and economic turbulence caused a decrease in city population.^[1]^

```{r population2}
pop.sub <- sub[c(1,3:10)]
colnames(pop.sub) <- c("neibor", seq(1940, 2010, 10))
pop.melt <- melt(pop.sub, id=c("neibor"))
pop.melt$variable <- as.numeric(as.character(pop.melt$variable))
pop.med <-data.frame(apply(pop[-1],2,median))
pop.med$variable <- seq(1940, 2010, 10)
names(pop.med)[1] <- "value"

ggplot(aes(x = variable, y = value, color = neibor, group = neibor),
       data= melt(pop, id=c("neibor"))) +
  geom_line() + guides(color = F) + xlab("Year") + ylab("Population") + ggtitle("Population for Each Pittsburgh Neighborhood")
```

This graph is really messy! But it is interesting that the neighborhood who has the max population keeps changing during 1940 - 1970. This is the max table for each year:

```{r}
pop.max <- melt(pop, id="neibor") %>% 
  group_by(variable) %>%
  top_n(1)
colnames(pop.max) <- c("Neighborhood", "Year", "Population")
knitr::kable(pop.max)
#melt(pop, id="neibor") %>% 
#  group_by(variable) %>%
#  filter(value == min(value))

```

Here's what I found:

* __South Side Flats__ dropped so quickly from 1940. I guess this change began even early, beause of the expansion of the steel plants, which replaced many residential buildings. And problem of air polution and flush made people left this county.^[2]^ 
* __Squirrel Hill South__ together with Squirrel Hill North, you can treat them as a single neighborhood. Their population change follows the overall trend of Pittsburgh very well. I infer some reasons from Wikipedia^[3]^:
    1. Squirrel Hill is a residential area, not an industrial zone. So when people left Pittsburgh, part of them from Squirrel Hill.
    2. Squirrel Hill did not affect much by political or municipal event.
    3. The composition of demographics is mainly white wealthy pepole, espacially Jewish (40%). They built business and culture here, which helps to keep this area stable.
* __Homewood South__ surged during 1950's due to the construction of Civic Arena. The city displaced 8000 people, and most of them were less affluent blacks. African-American influx caused a lot of the white middle class moved out of this area. And the business of Homewood was crippled by the riots caused by the assassination of Dr. Martin Luther King Jr. on 4 April 1968. That's why its population plunged in 1960's.^[4]^
* __Brookline__: kept growing during post-war years until 1970's. This growth is fed by Pittsburgh's steel mills. During Pittsburgh's Renaissance I in the 1950s, when the area of the Lower Hill District was demolished, many displaced city residents migrated to the area around lower Pioneer Avenue, spurring the last big population surge. With the steel industry declined, the population dropped quickly after 1970's.^[5]^


Then let's move to the analysis for neighborhood in Pittsburgh. But it is hard to interpret all of them on the graph because there are 90 neighborhoods in Pittsburgh. I lives in North Oakland now and once lived in Shadyside. So I will choose 7 of them: 

* North Oakland
* Central Oakland
* South Oakland
* West Oakland
* Shadyside
* Squirrel Hill North
* Squirrel Hill South.

```{r population3}
cols <- c("#E69F00", "#56B4E9","#999999", "#009E73", "#F0E442", "#0072B2", "#D55E00", "#CC79A7")
# cols <- c(rainbow(7)[1:2], "black", rainbow(7)[3:7])

ggplot() +
  geom_line(aes(x = variable, y = value, group = neibor, color = neibor, fill = neibor), data=pop.melt, size = 1.5) +
  geom_line(aes(x = variable, y = value, color ="Pittburgh Median", fill="Pittburgh Median"), data = pop.med, linetype = 2, size = 1.5) +
  scale_color_manual(name = 'Neighborhood', values = cols) +
  scale_x_continuous(name="Year", breaks = seq(1940, 2010, 10)) +
  scale_y_continuous(name="Population",breaks = seq(0,25000, 2500))


rank.change <- cbind(pop[1], pop[9] - pop[2])[order(pop[9] - pop[2]),]
head(rank.change)
tail(rank.change)
```


## Economic
```{r economic}
eco <- data[29:32]
names(eco) <- c("median.home.value.2010", "median.sale.price.2010", "median.income.2009", "poverty.rate.2010")
boxplot(eco[-4])
ggpairs(eco)
```

## Crime
```{r crime}
crime <- data[33:39]
names(crime) <- c("murder","rape","robbery","assault","burglary","auto.theft","drug.violations")
ggpairs(crime)
# cor.test(crime[[3]], crime[[4]])
# cor.test(pop[[9]], rowSums(crime))
# cor.test(data[[24]], rowSums(crime))
lm <- lm(rowSums(crime) ~ pop[[9]] + data[[24]])
```

```{r}
glm(median.sale.price.2010 ~ median.home.value.2010 + murder + rape + robbery + assault + burglary + auto.theft + drug.violations)
lm(log(median.sale.price.2010) ~ log(median.home.value.2010) + murder + rape + robbery + assault + burglary + auto.theft + drug.violations)
glm(median.sale.price.2010 ~ median.home.value.2010 + murder + rape + robbery + assault + burglary + auto.theft + drug.violations, family=Poisson)
prcomp(crime)
pc_crime <- prcomp(crime)
lm(log(median.sale.price.2010) ~ pc_crime$X)
```


[1]: http://en.wikipedia.org/wiki/Pittsburgh "Wikipedia: Pittsburgh"
[2]: http://en.wikipedia.org/wiki/South_Side_Flats "Wikipedia: South Side Flats"
[3]: http://en.wikipedia.org/wiki/Squirrel_Hill_(Pittsburgh) "Wikipedia: Squirrel Hill (Pittsburgh)"
[4]: http://en.wikipedia.org/wiki/Homewood_(Pittsburgh) "Wikipedia: Homewood (Pittsburgh)"
[5]: http://www.brooklineconnection.com "The Brookline Connection"
